# FLEXT-LDIF Examples

**Library-Only Examples** - Demonstrating RFC-first architecture with ZERO CLI dependencies.

## üéØ Overview

These examples demonstrate the **library-only, RFC-first architecture** of flext-ldif with:

- ‚úÖ **ZERO CLI** - All functionality through programmatic APIs
- ‚úÖ **RFC-First** - ALL operations through RFC parsers + quirks
- ‚úÖ **MANDATORY quirk_registry** - Zero bypass paths enforcement
- ‚úÖ **Generic Transformation** - Works with ANY LDAP server
- ‚úÖ **FlextResult Pattern** - Railway-oriented error handling

## üìö Examples

### 01_basic_parsing.py - Basic LDIF Parsing

**Demonstrates:**

- Library-only usage (NO CLI)
- Basic parsing with FlextLdifAPI facade
- FlextResult error handling
- Entry inspection

```bash
poetry run python examples/01_basic_parsing.py
```

**Concepts:**

- Parse LDIF from string or file
- Access entry attributes
- Inspect object classes
- Handle parse errors with FlextResult

### 02_server_specific_quirks.py - Server-Specific Quirks

**Demonstrates:**

- RFC-first architecture with quirks
- MANDATORY quirk_registry parameter
- Server-specific parsing (OID, OUD, OpenLDAP)
- Generic transformation pipeline

```bash
poetry run python examples/02_server_specific_quirks.py
```

**Concepts:**

- Initialize QuirkRegistryService (auto-discovers all quirks)
- Parse with server_type="oid" for OID quirks
- Parse with server_type=None for pure RFC
- Unknown servers fall back to RFC baseline

### 03_writing_ldif.py - Writing LDIF

**Demonstrates:**

- Creating entries programmatically
- Writing LDIF to string
- Writing LDIF to file
- FlextResult error handling

```bash
poetry run python examples/03_writing_ldif.py
```

**Concepts:**

- Create FlextLdifModels.Entry objects
- Write entries to LDIF string
- Write entries to file
- Verify written files by reading back

### 04_validation.py - Entry Validation

**Demonstrates:**

- RFC 2849 validation
- Entry filtering
- Statistics generation
- Railway-oriented pipeline

```bash
poetry run python examples/04_validation.py
```

**Concepts:**

- Validate entries against RFC 2849
- Filter by object class (person, group, etc.)
- Generate entry statistics
- Composable pipeline with flat_map

### 05_migration.py - Server Migration

**Demonstrates:**

- Generic transformation pipeline (Source ‚Üí RFC ‚Üí Target)
- OID to OUD migration
- MANDATORY quirk_registry usage
- Works with ANY LDAP server combination

```bash
poetry run python examples/05_migration.py
```

**Concepts:**

- FlextLdifMigrationPipeline for migrations
- Source ‚Üí RFC ‚Üí Target transformation
- Works with ANY server (N implementations, not N¬≤)
- Migration paths: OID‚ÜîOUD, OID‚ÜîOpenLDAP, OUD‚ÜîOpenLDAP, etc.

### 06_custom_quirks.py - Custom Quirks

**Demonstrates:**

- Creating custom server quirks
- Registering custom quirks with registry
- Extending RFC parsers for custom LDAP servers
- Protocol-based quirk interface

```bash
poetry run python examples/06_custom_quirks.py
```

**Concepts:**

- Implement SchemaQuirkProtocol
- Define server_type and priority
- Implement can*handle*\_and parse\_\_ methods
- Register custom quirk with QuirkRegistryService

## üöÄ Running All Examples

```bash
# Run all examples in sequence
for example in examples/0*.py; do
    echo "=== Running $example ==="
    poetry run python "$example"
    echo
done
```

## üìä Sample LDIF Files

The examples directory includes sample LDIF files:

- **`sample_basic.ldif`** - Simple person entries for basic parsing
- **`sample_complex.ldif`** - Complex directory structure with groups
- **`sample_invalid.ldif`** - Invalid LDIF for error handling
- **`output_basic.ldif`** - Generated by writing examples

## üéì Key Concepts Demonstrated

### 1. Library-Only Usage (NO CLI)

```python
# ‚ùå OLD (CLI - no longer available):
# python -m flext_ldif parse file.ldif

# ‚úÖ NEW (Library API):
from flext_ldif import FlextLdifAPI
api = FlextLdifAPI()
result = api.parse("file.ldif")
```

### 2. RFC-First Architecture

```python
from flext_ldif.quirks.registry import QuirkRegistryService
from flext_ldif.rfc.rfc_schema_parser import RfcSchemaParserService

# ‚ö†Ô∏è MANDATORY: quirk_registry parameter
quirk_registry = QuirkRegistryService()

parser = RfcSchemaParserService(
    params={"file_path": "schema.ldif"},
    quirk_registry=quirk_registry,  # MANDATORY - enforces RFC-first
    server_type="oid",  # Optional - None = pure RFC
)
```

### 3. FlextResult Pattern

```python
# Railway-oriented error handling
result = (
    api.parse("file.ldif")
    .flat_map(api.validate_entries)
    .flat_map(api.filter_persons)
    .map_error(lambda error: f"Processing failed: {error}")
)

if result.is_success:
    entries = result.unwrap()
else:
    print(result.error)
```

### 4. Generic Transformation

```python
# Works with ANY LDAP server (N implementations, not N¬≤)
migration = FlextLdifMigrationPipeline(
    input_dir="source_oid",
    output_dir="target_oud",
    source_server_type="oid",     # Oracle Internet Directory
    target_server_type="oud",     # Oracle Unified Directory
    quirk_registry=quirk_registry,
)

# Transforms: OID ‚Üí RFC ‚Üí OUD
result = migration.execute()
```

## üåç Supported LDAP Servers

### Complete Implementations (4 servers)

- ‚úÖ Oracle Internet Directory (OID)
- ‚úÖ Oracle Unified Directory (OUD)
- ‚úÖ OpenLDAP 2.x
- ‚úÖ OpenLDAP 1.x

### Stub Implementations (5 servers)

- ‚ö†Ô∏è Active Directory (AD) - stub
- ‚ö†Ô∏è Apache Directory Server - stub
- ‚ö†Ô∏è 389 Directory Server - stub
- ‚ö†Ô∏è Novell eDirectory - stub
- ‚ö†Ô∏è IBM Tivoli Directory Server - stub

### Generic/Unknown Servers

- ‚úÖ ANY unknown server uses pure RFC baseline

## üîó Integration with FLEXT Ecosystem

These examples demonstrate integration with:

- **flext-core**: FlextResult, FlextLogger, FlextService, FlextContainer
- **Railway Pattern**: Composable error handling with flat_map
- **Domain Models**: Pydantic v2 models with type annotations
- **Type Safety**: Complete type hints with Python 3.13+

## üìñ Further Reading

- **docs/architecture.md** - RFC-first architecture details
- **docs/api-reference.md** - Complete API documentation
- **README.md** - Library overview and quick start

---

**Note**: All examples use library-only APIs. flext-ldif has NO CLI dependencies.
