# Migration Guide: v0.9 to v1.0

<!-- TOC START -->

- [Overview](#overview)
- [For Standard Users (No Changes Required)](#for-standard-users-no-changes-required)
- [For Advanced Users (Import Changes)](#for-advanced-users-import-changes)
  - [1. Module Import Path Changes](#1-module-import-path-changes)
  - [2. Processor Changes (Use flext-core Directly)](#2-processor-changes-use-flext-core-directly)
  - [3. Entry Helper Methods Removed (Use Model Methods)](#3-entry-helper-methods-removed-use-model-methods)
  - [4. Property Accessors Removed (Direct Imports)](#4-property-accessors-removed-direct-imports)
  - [5. Pattern Matching for Unified Methods](#5-pattern-matching-for-unified-methods)
- [Automated Migration Script](#automated-migration-script)
- [Test Migration](#test-migration)
- [Troubleshooting](#troubleshooting)
  - [Import Errors](#import-errors)
  - [Attribute Errors on FlextLdif](#attribute-errors-on-flextldif)
  - [Type Errors with parse()](#type-errors-with-parse)
- [Getting Help](#getting-help)
  - [Resources](#resources)
  - [Support](#support)
- [Summary](#summary)

<!-- TOC END -->

## Overview

Version 1.0 simplifies flext-ldif through structural and architectural changes documented in ADR-006. The **public API remains stable** - most users require no changes. This guide helps advanced users who import internal modules.

**Key Changes**:

- ✅ **Flat module structure** - Modules moved to root (except `quirks/`)
- ✅ **FlextProcessors direct usage** - Custom processor wrappers removed
- ✅ **Wrapper methods removed** - Use model methods directly
- ✅ **FlextDecorators applied** - Automatic logging and performance tracking
- ✅ **FlextService inheritance** - Services inherit from base class
- ✅ **Python 3.13+ patterns** - Pattern matching for unified methods

**Breaking Changes**: Internal imports only (public API unchanged)

______________________________________________________________________

## For Standard Users (No Changes Required)

If you use the main API, **no migration needed**:

```python
# ✅ This still works (v0.9 and v1.0)
from flext_ldif import FlextLdif

ldif = FlextLdif()
result = ldif.parse("directory.ldif")

if result.is_success:
    entries = result.unwrap()
    print(f"Parsed {len(entries)} entries")
```

**Public API Methods (Unchanged)**:

- `ldif.parse()` - Parse LDIF files
- `ldif.parse_with_auto_detection()` - Parse with server detection
- `ldif.parse_relaxed()` - Lenient parsing
- `ldif.write()` - Write LDIF files
- `ldif.filter()` - Filter entries
- `ldif.categorize()` - Categorize entries
- `ldif.migrate()` - Server migration
- `ldif.validate_entries()` - Entry validation
- `ldif.analyze()` - Entry analytics

______________________________________________________________________

## For Advanced Users (Import Changes)

### 1. Module Import Path Changes

**Module paths changed due to flat structure.**

#### RFC Modules

**Before** (v0.9):

```python
from flext_ldif.rfc.rfc_ldif_parser import RfcLdifParser
from flext_ldif.rfc.rfc_ldif_writer import RfcLdifWriter
from flext_ldif.rfc.rfc_schema_parser import RfcSchemaParserService
```

**After** (v1.0):

```python
from flext_ldif.services.rfc_ldif_parser import FlextLdifRfcLdifParser
from flext_ldif.services.rfc_ldif_writer import FlextLdifRfcLdifWriter
from flext_ldif.services.parser import FlextLdifParser
```

#### Service Modules

**Before** (v0.9):

```python
from flext_ldif.services.detector import FlextLdifDetector
from flext_ldif.services.validation_service import FlextLdifValidation
from flext_ldif.services.statistics_service import FlextLdifStatistics
from flext_ldif.services.dn_service import FlextLdifDn
from flext_ldif.services.file_writer_service import FlextLdifFileWriter
```

**After** (v1.0):

```python
from flext_ldif.detector import FlextLdifDetector
from flext_ldif.validation_service import FlextLdifValidation
from flext_ldif.statistics_service import FlextLdifStatistics
from flext_ldif.dn_service import FlextLdifDn
from flext_ldif.file_writer_service import FlextLdifFileWriter
```

#### ACL Modules

**Before** (v0.9):

```python
from flext_ldif.acl.parser import FlextLdifAclParser
from flext_ldif.acl.service import FlextLdifAcl
from flext_ldif.acl.utils import FlextLdifUtilities
```

**After** (v1.0):

```python
from flext_ldif.acl_parser import FlextLdifAclParser
from flext_ldif.acl_service import FlextLdifAcl
from flext_ldif.utilities import FlextLdifUtilities

# ACL utilities are now available via:
# FlextLdifUtilities.AclUtils.ComponentFactory.create_acl_components()
# FlextLdifUtilities.AclUtils.ComponentFactory.create_unified_acl()
```

#### Pipeline Modules

**Before** (v0.9):

```python
from flext_ldif.pipelines.migration_pipeline import FlextLdifMigrationPipeline
from flext_ldif.pipelines.categorized_pipeline import FlextLdifCategorizedPipeline
```

**After** (v1.0):

```python
from flext_ldif.migration_pipeline import FlextLdifMigrationPipeline
from flext_ldif.categorized_pipeline import FlextLdifCategorizedPipeline
```

#### Event Modules

**Before** (v0.9):

```python
from flext_ldif.events.ldif_events import (
    LdifParsedEvent,
    LdifValidatedEvent,
    LdifWrittenEvent,
)
```

**After** (v1.0):

```python
from flext_ldif.ldif_events import (
    LdifParsedEvent,
    LdifValidatedEvent,
    LdifWrittenEvent,
)
```

#### Quirks Modules (Unchanged)

**Quirks structure unchanged** - still uses subdirectory:

```python
# ✅ Same in v0.9 and v1.0
from flext_ldif.services.server import FlextLdifServer
from flext_ldif.services.manager import FlextLdifQuirksManager
from flext_ldif.services.conversion import QuirksConversionMatrix
from flext_ldif.servers.oid import FlextLdifServersOid
from flext_ldif.servers.ouds import FlextLdifServersOud
```

______________________________________________________________________

### 2. Processor Changes (Use flext-core Directly)

**Custom processor wrappers removed** - use `FlextProcessors` from flext-core directly.

**Before** (v0.9):

```python
from flext_ldif import FlextLdif

ldif = FlextLdif()
processor = ldif.processors  # ❌ Property removed
result = processor.batch_process(entries, func)
```

**After** (v1.0):

```python
from flext_core import FlextProcessors

processor = FlextProcessors()  # ✅ Direct usage
result = processor.batch_process(entries, func)
```

**Rationale**: Custom processors were just wrappers around `FlextProcessors` with no added value. Direct usage is simpler and more explicit.

______________________________________________________________________

### 3. Entry Helper Methods Removed (Use Model Methods)

**Wrapper methods removed** - use model methods directly.

#### get_entry_dn() Removed

**Before** (v0.9):

```python
from flext_ldif import FlextLdif

ldif = FlextLdif()
dn_result = ldif.get_entry_dn(entry)  # ❌ Method removed
if dn_result.is_success:
    dn = dn_result.unwrap()
```

**After** (v1.0):

```python
dn = entry.dn.value  # ✅ Direct access
```

#### get_entry_attributes() Removed

**Before** (v0.9):

```python
attrs_result = ldif.get_entry_attributes(entry)  # ❌ Method removed
if attrs_result.is_success:
    attrs = attrs_result.unwrap()
```

**After** (v1.0):

```python
attrs = entry.attributes.to_ldap3()  # ✅ Built-in method
```

#### get_entry_objectclasses() Removed

**Before** (v0.9):

```python
oc_result = ldif.get_entry_objectclasses(entry)  # ❌ Method removed
if oc_result.is_success:
    objectclasses = oc_result.unwrap()
```

**After** (v1.0):

```python
objectclasses = entry.get_attribute_values("objectClass")  # ✅ Model method
```

#### create_entry() Removed

**Before** (v0.9):

```python
result = ldif.create_entry(dn="cn=test", attributes={...})  # ❌ Method removed
```

**After** (v1.0):

```python
from flext_ldif import FlextLdifModels

result = FlextLdifModels.Entry.create(dn="cn=test", attributes={...})  # ✅ Factory method
```

______________________________________________________________________

### 4. Property Accessors Removed (Direct Imports)

**Property wrappers removed** - import classes directly.

#### models Property Removed

**Before** (v0.9):

```python
ldif = FlextLdif()
models = ldif.models  # ❌ Property removed
```

**After** (v1.0):

```python
from flext_ldif import FlextLdifModels  # ✅ Direct import
```

#### config Property Removed

**Before** (v0.9):

```python
ldif = FlextLdif()
config = ldif.config  # ❌ Property removed
```

**After** (v1.0):

```python
from flext_ldif import FlextLdifSettings  # ✅ Direct import
config = FlextLdifSettings()
```

#### constants Property Removed

**Before** (v0.9):

```python
ldif = FlextLdif()
constants = ldif.constants  # ❌ Property removed
```

**After** (v1.0):

```python
from flext_ldif import FlextLdifConstants  # ✅ Direct import
max_line = FlextLdifConstants.LdifFormatting.MAX_LINE_WIDTH
```

______________________________________________________________________

### 5. Pattern Matching for Unified Methods

**Unified methods simplified** with Python 3.13+ pattern matching.

#### parse() Method

**Before** (v0.9):

```python
# Multiple boolean flags
result = ldif.parse(source, batch=True)  # ❌ Old style
result = ldif.parse(source, paginate=True, page_size=500)  # ❌ Old style
```

**After** (v1.0):

```python
from typing import Literal

# Explicit mode parameter
result = ldif.parse(source, mode="batch")  # ✅ New style
result = ldif.parse(source, mode="paginate", page_size=500)  # ✅ New style
result = ldif.parse(source, mode="single")  # ✅ Explicit (default)
```

**Type Safety**: Mode parameter uses `Literal["single", "batch", "paginate"]` for IDE autocomplete and type checking.

#### build() Method

**Before** (v0.9):

```python
result = ldif.build("person", cn="John", sn="Doe", base_dn="dc=example")
```

**After** (v1.0):

```python
from typing import Literal

# Type-safe entry_type with Literal
result = ldif.build("person", cn="John", sn="Doe", base_dn="dc=example")  # ✅ Same usage

# IDE provides autocomplete for: "person", "group", "ou", "custom"
```

______________________________________________________________________

## Automated Migration Script

**Run this script to update your imports automatically**:

```bash
#!/bin/bash
# save as migrate-flext-ldif-imports.sh

echo "Migrating flext-ldif imports from v0.9 to v1.0..."

# Update RFC module imports
find . -name "*.py" -exec sed -i \
  's|from flext_ldif\.rfc\.rfc_ldif_parser|from flext_ldif.rfc_ldif_parser|g' {} \;
find . -name "*.py" -exec sed -i \
  's|from flext_ldif\.rfc\.rfc_ldif_writer|from flext_ldif.rfc_ldif_writer|g' {} \;
find . -name "*.py" -exec sed -i \
  's|from flext_ldif\.rfc\.rfc_schema_parser|from flext_ldif.rfc_schema_parser|g' {} \;

# Update services module imports
find . -name "*.py" -exec sed -i \
  's|from flext_ldif\.services\.|from flext_ldif.|g' {} \;

# Update ACL module imports
find . -name "*.py" -exec sed -i \
  's|from flext_ldif\.acl\.|from flext_ldif.acl_|g' {} \;

# Update schema module imports
find . -name "*.py" -exec sed -i \
  's|from flext_ldif\.schema\.|from flext_ldif.schema_|g' {} \;
find . -name "*.py" -exec sed -i \
  's|from flext_ldif\.schema\.objectclass_manager|from flext_ldif.objectclass_manager|g' {} \;

# Update entry module imports
find . -name "*.py" -exec sed -i \
  's|from flext_ldif\.entry\.builder|from flext_ldif.entry_builder|g' {} \;

# Update pipeline module imports
find . -name "*.py" -exec sed -i \
  's|from flext_ldif\.pipelines\.|from flext_ldif.|g' {} \;

# Update event module imports
find . -name "*.py" -exec sed -i \
  's|from flext_ldif\.events\.ldif_events|from flext_ldif.ldif_events|g' {} \;

# Remove processor imports (use flext-core directly)
# Manual review required for:
# - ldif.processors usage
# - FlextLdifBatchProcessor/FlextLdifParallelProcessor direct imports

echo "Migration complete! Review changes before committing."
echo "Run tests: make test"
```

**Usage**:

```bash
chmod +x migrate-flext-ldif-imports.sh
./migrate-flext-ldif-imports.sh
make test  # Verify changes
```

______________________________________________________________________

## Test Migration

If you have tests importing internal modules, update test imports:

**Before** (v0.9):

```python
# tests/test_my_feature.py
from flext_ldif.services.rfc_ldif_parser import FlextLdifRfcLdifParser
from flext_ldif.services.detector import FlextLdifDetector
```

**After** (v1.0):

```python
# tests/test_my_feature.py
from flext_ldif.services.rfc_ldif_parser import FlextLdifRfcLdifParser
from flext_ldif.services.detector import FlextLdifDetector
```

______________________________________________________________________

## Troubleshooting

### Import Errors

**Error**: `ModuleNotFoundError: No module named 'flext_ldif.rfc'`

**Solution**: Update imports to flat structure:

```python
# Change:
from flext_ldif.rfc.rfc_ldif_parser import RfcLdifParser
# To:
from flext_ldif.services.rfc_ldif_parser import FlextLdifRfcLdifParser
```

### Attribute Errors on FlextLdif

**Error**: `AttributeError: 'FlextLdif' object has no attribute 'processors'`

**Solution**: Use `FlextProcessors` from flext-core directly:

```python
from flext_core import FlextProcessors
processor = FlextProcessors()
```

**Error**: `AttributeError: 'FlextLdif' object has no attribute 'get_entry_dn'`

**Solution**: Use model methods directly:

```python
dn = entry.dn.value  # Instead of ldif.get_entry_dn(entry)
```

### Type Errors with parse()

**Error**: `TypeError: parse() got an unexpected keyword argument 'batch'`

**Solution**: Use `mode` parameter:

```python
# Old: parse(source, batch=True)
# New: parse(source, mode="batch")
```

______________________________________________________________________

## Getting Help

### Resources

- **Documentation**: docs/README.md
- **API Reference**: docs/api-reference.md
- **Architecture**: docs/architecture.md
- **ADR-006**: docs/adr/adr-006-simplification-refactoring.md

### Support

- **Issues**: <https://github.com/flext-sh/flext-ldif/issues>
- **Discussions**: <https://github.com/flext-sh/flext-ldif/discussions>

______________________________________________________________________

## Summary

**For Most Users**: No changes required - public API is stable.

**For Advanced Users**: Update imports (flat structure), use flext-core directly, use model methods instead of wrappers.

**Benefits**:

- Simpler structure
- Direct flext-core integration
- Better performance tracking
- Type safety with pattern matching

**Timeline**: Migration takes ~15-30 minutes for typical projects using automated script.
